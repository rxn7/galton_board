(()=>{"use strict";var t,i,n={d:(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};n.d({},{no:()=>u,ej:()=>c,OQ:()=>m}),function(t){const i=Math.PI/180;function n(t,i,n){return t+(i-t)*n}t.degreesToRadians=t=>t*i,t.directionFromAngle=function(i){const n=t.degreesToRadians(i);return{x:Math.cos(n),y:Math.sin(n)}},t.maxFromArray=function(t){if(0===t.length)return NaN;let i=t[0];for(let n of t)n>i&&(i=n);return i},t.lerp=n,t.lerpVector2=function(t,i,e){return{x:n(t.x,i.x,e),y:n(t.y,i.y,e)}}}(t||(t={})),function(t){const i=document.getElementById("row-count-input");i.addEventListener("input",(t=>{m(parseInt(t.target.value))})),t.ballBounceTime=200;const n=document.getElementById("ball-bounce-time-input");n.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballBounceTime=n})),t.ballSpawnInterval=150;const e=document.getElementById("ball-spawn-interval-input");e.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballSpawnInterval=n})),t.init=function(){e.value=t.ballSpawnInterval.toString(),n.value=t.ballBounceTime.toString(),i.value=u.rowCount.toString()}}(i||(i={}));class e{constructor(t){this.startPosition=t,this.queueDelete=!1,this.position={x:0,y:0},this.timer=0,this.lastPin=void 0,this.nextPin={row:0,idx:0},this.position=t}update(n,e){this.timer+=e;const o=this.lastPin?n.getPinPosition(this.lastPin):this.startPosition,s=n.getPinPosition(this.nextPin),a=Math.min(this.timer/i.ballBounceTime,1);if(this.position=this.bouncePosition(n,t.lerpVector2(o,s,a),a),a>=1){if(this.timer=0,this.nextPin.row>=n.rowCount-1)return this.queueDelete=!0,void n.registerHit(this.nextPin.idx);this.calculateNextPin(n)}}render(t,i){i.beginPath(),i.fillStyle=e.color,i.arc(this.position.x,this.position.y,t.pinRadius,0,2*Math.PI,!1),i.fill()}calculateNextPin(t){this.lastPin=this.nextPin,this.nextPin=t.getNextPin(this.lastPin)}bouncePosition(t,i,n){const e=Math.sin(n*Math.PI)*t.pinRadius*3;return{x:i.x,y:i.y-e}}}e.color="#689d6a";const o=e;class s{constructor(t,i=1){this.url=t,this.gainNode=s.ctx.createGain(),this.load(),this.gainNode.gain.value=i,this.gainNode.connect(s.ctx.destination)}async load(){const t=await fetch(this.url),i=await t.arrayBuffer();this.buffer=await s.ctx.decodeAudioData(i)}play(t=1){const i=s.ctx.createBufferSource();i.buffer=this.buffer,i.connect(this.gainNode),i.playbackRate.value=t,i.start()}}s.ctx=new AudioContext;const a=s;class r{constructor(t,i=8){this.rowCount=i,this.yOffset=10,this.pinSpacing=8,this.pinRadius=8,this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.columnsHitCount=[],this.graphSize=100;for(let t=0;t<this.rowCount;++t)this.columnsHitCount.push(0);this.onCanvasResize(t)}onCanvasResize(t){const i=Math.min(t.clientWidth,t.clientHeight);this.pinSpacing=i/(12*this.rowCount),this.pinRadius=i/(8*this.rowCount),this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.graphSize=i/2.5;const n=this.rowCount*this.rowHeight+this.graphSize;this.yOffset=.5*(t.clientHeight-n)}render(i){const n=t.maxFromArray(this.columnsHitCount);for(let t=0;t<this.rowCount;++t)for(let e=0;e<t+1;++e){const o=this.getPinPosition({row:t,idx:e}),s=t===this.rowCount-1;let a=this.pinRadius;if(s){a*=2;const t=this.columnsHitCount[e]/n;this.renderGraphLine(i,o.x,o.y,t)}else a*=.5;i.beginPath(),i.arc(o.x,o.y,a,0,2*Math.PI),i.fillStyle="#cc241d",i.fill(),s&&(i.fillStyle="#fbf1c7",i.textAlign="center",i.textBaseline="top",i.font=`bold ${a}px monospace`,i.fillText(this.columnsHitCount[e].toString(),o.x,o.y-.5*a,2*a))}}registerHit(t){++this.columnsHitCount[t],r.hitSound.play(.5+1*Math.random())}renderGraphLine(t,i,n,e){t.beginPath(),t.fillStyle="#fbf1c7",t.roundRect(i-this.pinRadius,n,2*this.pinRadius,e*this.graphSize,[0,0,this.pinRadius,this.pinRadius]),t.fill(),t.beginPath()}getNextPin(t){const i=t.row+1;let n;return n=0===t.idx?Math.random()>.5?0:1:t.idx===t.row?Math.random()>.5?i-1:i:t.idx+(Math.random()>.5?0:1),{row:i,idx:n}}getPinPosition(t){return{x:.5*c.canvas.clientWidth-t.row*this.rowHeight+t.idx*this.rowHeight*2,y:this.pinRadius+t.row*this.rowHeight+this.yOffset}}}r.hitSound=new a("audio/hit.ogg",.1);const h=r,l=1/60,c=document.getElementById("canvas").getContext("2d",{alpha:!1,willReadFrequently:!1});let u=new h(c.canvas,19);const d=[];let p=0;function g(t){if(requestAnimationFrame(g),document.hidden)return;const i=Math.min(100,Math.max(t-p,l));p=t,c.fillStyle="#282828",c.fillRect(0,0,c.canvas.clientWidth,c.canvas.clientHeight),u.render(c),d.forEach(((t,n,e)=>{t.update(u,i),t.queueDelete?e.splice(n,1):t.render(u,c)}))}function f(){d.push(new o({x:.5*c.canvas.clientWidth,y:-u.pinRadius})),setTimeout(f,i.ballSpawnInterval+Math.random()*i.ballSpawnInterval*.1)}function m(t){d.length=0,u=new h(c.canvas,t)}!function(){c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high";const t=()=>{c.canvas.width=window.innerWidth,c.canvas.height=window.innerHeight,u.onCanvasResize(c.canvas)};i.init(),t(),window.addEventListener("resize",(()=>t())),requestAnimationFrame(g),f()}()})();