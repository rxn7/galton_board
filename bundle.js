(()=>{"use strict";var t,i,n={d:(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})}};n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var i=n.g.document;if(!t&&i&&(i.currentScript&&"SCRIPT"===i.currentScript.tagName.toUpperCase()&&(t=i.currentScript.src),!t)){var e=i.getElementsByTagName("script");if(e.length)for(var o=e.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=e[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.d({},{no:()=>u,ej:()=>l,OQ:()=>f}),function(t){const i=Math.PI/180;function n(t,i,n){return t+(i-t)*n}function e(t){const i=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*e(1-t));--t;let n=i[0];for(let e=1;e<9;++e)n+=i[e]/(t+e);let o=t+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(o,t+.5)*Math.exp(-o)*n}function o(t,i){return t<i?0:e(t)/(e(i)*e(t-i))}t.degreesToRadians=t=>t*i,t.directionFromAngle=function(i){const n=t.degreesToRadians(i);return{x:Math.cos(n),y:Math.sin(n)}},t.maxFromArray=function(t){if(0===t.length)return NaN;let i=t[0];for(let n of t)n>i&&(i=n);return i},t.lerp=n,t.lerpVector2=function(t,i,e){return{x:n(t.x,i.x,e),y:n(t.y,i.y,e)}},t.lerpColor=function(t,i,e){const o=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),a=parseInt(i.substring(1,3),16),h=parseInt(i.substring(3,5),16),l=parseInt(i.substring(5,7),16);return`rgb(${Math.round(n(o,a,e))},${Math.round(n(s,h,e))},${Math.round(n(r,l,e))})`},t.mean=function(t){return t.reduce(((t,i)=>t+i),0)/t.length},t.factorial=e,t.binomialCoefficient=o,t.binomialDistribution=function(t,i,n){return o(t,i)*Math.pow(n,i)*Math.pow(1-n,t-i)}}(t||(t={})),function(t){const i=document.getElementById("row-count-input");i.addEventListener("input",(t=>{f(parseInt(t.target.value))})),t.ballBounceTime=200;const n=document.getElementById("ball-bounce-time-input");n.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballBounceTime=n})),t.ballSpawnInterval=150;const e=document.getElementById("ball-spawn-interval-input");e.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballSpawnInterval=n})),t.simulateButton=document.getElementById("simulate-button"),t.simulateButton.addEventListener("click",(()=>{const t=prompt("How many balls do you want to simulate?","100000"),i=parseInt(t||"");!isNaN(i)&&i>0&&u.simulate(i)})),t.init=function(){e.value=t.ballSpawnInterval.toString(),n.value=t.ballBounceTime.toString(),i.value=u.rowCount.toString()}}(i||(i={}));class e{constructor(t){this.startPosition=t,this.queueDelete=!1,this.position={x:0,y:0},this.timer=0,this.lastPinPosition=void 0,this.nextPinPosition={row:0,idx:0},this.position=t}update(n,e){this.timer+=e;const o=this.lastPinPosition?n.getPinWorldPosition(this.lastPinPosition):this.startPosition;o.y-=2*n.pinRadius;const s=n.getPinWorldPosition(this.nextPinPosition);s.y-=2*n.pinRadius;const r=Math.min(this.timer/i.ballBounceTime,1);if(this.position=this.bouncePosition(n,t.lerpVector2(o,s,r),r),r>=1){if(this.timer=0,n.onPinHit(this.nextPinPosition),this.nextPinPosition.row>=n.rowCount-1)return void(this.queueDelete=!0);this.calculateNextPin(n)}}render(t,i){i.beginPath(),i.fillStyle=e.color,i.arc(this.position.x,this.position.y,t.pinRadius,0,2*Math.PI,!1),i.fill()}calculateNextPin(t){this.lastPinPosition=this.nextPinPosition,this.nextPinPosition=t.getNextPin(this.lastPinPosition)}bouncePosition(t,i,n){const e=Math.sin(n*Math.PI)*t.pinRadius*3;return{x:i.x,y:i.y-e}}}e.color="#689d6a";const o=e;class s{constructor(t,i=1){this.url=t,this.gainNode=s.ctx.createGain(),this.load(),this.gainNode.gain.value=i,this.gainNode.connect(s.ctx.destination)}async load(){const t=await fetch(this.url),i=await t.arrayBuffer();this.buffer=await s.ctx.decodeAudioData(i)}play(t=1){const i=s.ctx.createBufferSource();i.buffer=this.buffer,i.connect(this.gainNode),i.playbackRate.value=t,i.start()}}s.ctx=new AudioContext;const r=new s(n.p+"assets/audio/hit.ogg",.1);class a{constructor(t,i=8){this.rowCount=i,this.yOffset=10,this.pinSpacing=8,this.pinRadius=8,this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.hitPins=[],this.pins=new Array(this.rowCount),this.graphSize=0,this.hitPins=new Array(this.rowCount);for(let t=0;t<this.rowCount;++t){this.hitPins[t]={hitCount:0},this.pins[t]=new Array(t+1);for(let i=0;i<t+1;++i)this.pins[t][i]={lastTimeHit:-1}}this.onCanvasResize(t)}onCanvasResize(t){const i=Math.min(t.clientWidth,t.clientHeight);this.pinSpacing=i/(10*this.rowCount),this.pinRadius=i/(7*this.rowCount),this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.graphSize=i/4;const n=this.rowCount*this.rowHeight+this.graphSize;this.yOffset=.5*(t.clientHeight-n)}render(t){let i=0,n=0;this.hitPins.forEach((t=>{i+=t.hitCount,t.hitCount>n&&(n=t.hitCount)})),this.renderDistribution(t);for(let e=0;e<this.rowCount;++e)for(let o=0;o<e+1;++o){const s={row:e,idx:o},r={position:this.getPinWorldPosition(s),radius:this.pinRadius,color:"#cc241d"},a=this.isHitPin(s);if(a){r.radius*=2;const e=this.hitPins[o].hitCount,s=e/n;this.renderGraphLine(t,r.position.x,r.position.y,s);const a=e/i;this.renderGraphText(t,r.position.x,r.position.y,a,s)}this.handlePinAnimation(s,r),this.renderPin(r),a&&this.renderHitPinText(o,r)}}onPinHit(t,i=!0){this.pins[t.row][t.idx].lastTimeHit=performance.now(),t.row===this.rowCount-1&&++this.hitPins[t.idx].hitCount,this.isHitPin(t)&&i&&r.play(.5+1*Math.random())}getNextPin(t){const i=t.row+1;let n;return n=0===t.idx?Math.random()>.5?0:1:t.idx===t.row?Math.random()>.5?i-1:i:t.idx+(Math.random()>.5?0:1),{row:i,idx:n}}getPinWorldPosition(t){return{x:.5*l.canvas.clientWidth-t.row*this.rowHeight+t.idx*this.rowHeight*2,y:this.getRowY(t.row)}}getRowY(t){return this.pinRadius+t*this.rowHeight+this.yOffset}isHitPin(t){return t.row===this.rowCount-1}simulate(t){for(let i=0;i<t;++i){let t={row:0,idx:0};for(;t.row<this.rowCount-1;)t=this.getNextPin(t);this.onPinHit({row:t.row,idx:t.idx},!1)}r.play(.5+1*Math.random())}renderPin(t){l.beginPath(),l.arc(t.position.x,t.position.y,t.radius,0,2*Math.PI),l.fillStyle=t.color,l.fill()}renderHitPinText(t,i){l.fillStyle="#fbf1c7",l.textAlign="center",l.textBaseline="top",l.font=`bold ${i.radius}px monospace`,l.fillText(this.hitPins[t].hitCount.toString(),i.position.x,i.position.y-.5*i.radius,2*i.radius)}renderGraphLine(t,i,n,e){t.beginPath(),t.fillStyle="#fbf1c7",t.roundRect(i-this.pinRadius,n,2*this.pinRadius,e*this.graphSize,[0,0,this.pinRadius,this.pinRadius]),t.fill(),t.beginPath()}renderGraphText(i,n,e,o,s){i.fillStyle=t.lerpColor("#ff0000","#00ff00",s),i.textAlign="center",i.textBaseline="top";const r=2*this.pinRadius;i.font=`bold ${r}px monospace`,i.fillText(`${(100*o).toFixed(2)}%`,n,e+this.graphSize*s+this.pinRadius+.5*r)}renderDistribution(i){const n={row:this.rowCount-1,idx:0},e={row:this.rowCount-1,idx:this.rowCount-1},o=this.getPinWorldPosition(n).x-2*this.pinRadius,s=this.getRowY(this.rowCount-1)+2,r=this.getPinWorldPosition(e).x+2*this.pinRadius-o,a=t.binomialDistribution(this.rowCount-1,Math.floor(this.rowCount/2),.5);i.beginPath(),i.moveTo(o,s);const h=r/100;for(let n=1;n<=100;++n){const e=o+n*h,l=(e-o)/r*(this.rowCount-1),u=s+t.binomialDistribution(this.rowCount-1,l,.5)/a*(this.graphSize+2);i.lineTo(e,u)}i.strokeStyle="#458588",i.lineWidth=2,i.stroke()}handlePinAnimation(i,n){const e=this.pins[i.row][i.idx];if(e.lastTimeHit>-1){const o=performance.now()-e.lastTimeHit;if(o<a.hitPinAnimationDuration)if(this.isHitPin(i)){const i=o/a.hitPinAnimationDuration;n.position.y+=Math.sin(i*Math.PI)*n.radius,n.radius+=Math.sin(i*Math.PI)*n.radius*.2,n.color=t.lerpColor(n.color,"#00ff00",i)}else{const t=o/a.normalPinAnimationDuration;n.position.y+=Math.sin(t*Math.PI)*n.radius*.5}}}}a.hitPinAnimationDuration=200,a.normalPinAnimationDuration=100;const h=a,l=document.getElementById("canvas").getContext("2d",{alpha:!1,willReadFrequently:!1});let u=new h(l.canvas,19);const c=[];let d=0;function p(t){if(requestAnimationFrame(p),document.hidden)return;const i=Math.min(t-d,100);d=t,l.fillStyle="#282828",l.fillRect(0,0,l.canvas.clientWidth,l.canvas.clientHeight),u.render(l),c.forEach(((t,n,e)=>{t.update(u,i),t.queueDelete?e.splice(n,1):t.render(u,l)}))}function w(){c.push(new o({x:.5*l.canvas.clientWidth,y:-u.pinRadius})),setTimeout(w,i.ballSpawnInterval+Math.random()*i.ballSpawnInterval*.1)}function f(t){c.length=0,u=new h(l.canvas,t)}!function(){l.imageSmoothingEnabled=!1,l.translate(.5,.5);const t=()=>{const t=Math.ceil(window.devicePixelRatio);l.canvas.width=window.innerWidth*t,l.canvas.height=window.innerHeight*t,l.canvas.style.width=`${window.innerWidth}px`,l.canvas.style.height=`${window.innerHeight}px`,l.setTransform(t,0,0,t,0,0),u.onCanvasResize(l.canvas)};i.init(),t(),window.addEventListener("resize",(()=>t())),requestAnimationFrame(p),w()}()})();