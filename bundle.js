(()=>{"use strict";var t,i,n={d:(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})}};n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var i=n.g.document;if(!t&&i&&(i.currentScript&&"SCRIPT"===i.currentScript.tagName.toUpperCase()&&(t=i.currentScript.src),!t)){var e=i.getElementsByTagName("script");if(e.length)for(var o=e.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=e[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.d({},{no:()=>l,ej:()=>u,OQ:()=>f}),function(t){const i=Math.PI/180;function n(t,i,n){return t+(i-t)*n}function e(t){const i=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*e(1-t));--t;let n=i[0];for(let e=1;e<9;++e)n+=i[e]/(t+e);let o=t+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(o,t+.5)*Math.exp(-o)*n}function o(t,i){return t<i?0:e(t)/(e(i)*e(t-i))}t.degreesToRadians=t=>t*i,t.directionFromAngle=function(i){const n=t.degreesToRadians(i);return{x:Math.cos(n),y:Math.sin(n)}},t.maxFromArray=function(t){if(0===t.length)return NaN;let i=t[0];for(let n of t)n>i&&(i=n);return i},t.lerp=n,t.lerpVector2=function(t,i,e){return{x:n(t.x,i.x,e),y:n(t.y,i.y,e)}},t.lerpColor=function(t,i,e){const o=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),a=parseInt(i.substring(1,3),16),h=parseInt(i.substring(3,5),16),u=parseInt(i.substring(5,7),16);return`rgb(${Math.round(n(o,a,e))},${Math.round(n(s,h,e))},${Math.round(n(r,u,e))})`},t.mean=function(t){return t.reduce(((t,i)=>t+i),0)/t.length},t.factorial=e,t.binomialCoefficient=o,t.binomialDistribution=function(t,i,n){return o(t,i)*Math.pow(n,i)*Math.pow(1-n,t-i)}}(t||(t={})),function(t){const i=document.getElementById("row-count-input");i.addEventListener("input",(t=>{f(parseInt(t.target.value))})),t.ballBounceTime=200;const n=document.getElementById("ball-bounce-time-input");n.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballBounceTime=n})),t.ballSpawnInterval=150;const e=document.getElementById("ball-spawn-interval-input");e.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballSpawnInterval=n})),t.simulateButton=document.getElementById("simulate-button"),t.simulateButton.addEventListener("click",(()=>{const t=prompt("How many balls do you want to simulate?","100000"),i=parseInt(t||"");!isNaN(i)&&i>0&&l.simulate(i)})),t.init=function(){e.value=t.ballSpawnInterval.toString(),n.value=t.ballBounceTime.toString(),i.value=l.rowCount.toString()}}(i||(i={}));class e{constructor(t){this.startPosition=t,this.queueDelete=!1,this.position={x:0,y:0},this.timer=0,this.lastPin=void 0,this.nextPin={row:0,idx:0},this.position=t}update(n,e){this.timer+=e;const o=this.lastPin?n.getPinPosition(this.lastPin):this.startPosition,s=n.getPinPosition(this.nextPin),r=Math.min(this.timer/i.ballBounceTime,1);if(this.position=this.bouncePosition(n,t.lerpVector2(o,s,r),r),r>=1){if(this.timer=0,this.nextPin.row>=n.rowCount-1)return this.queueDelete=!0,void n.registerHit(this.nextPin.idx);this.calculateNextPin(n)}}render(t,i){i.beginPath(),i.fillStyle=e.color,i.arc(this.position.x,this.position.y,t.pinRadius,0,2*Math.PI,!1),i.fill()}calculateNextPin(t){this.lastPin=this.nextPin,this.nextPin=t.getNextPin(this.lastPin)}bouncePosition(t,i,n){const e=Math.sin(n*Math.PI)*t.pinRadius*3;return{x:i.x,y:i.y-e}}}e.color="#689d6a";const o=e;class s{constructor(t,i=1){this.url=t,this.gainNode=s.ctx.createGain(),this.load(),this.gainNode.gain.value=i,this.gainNode.connect(s.ctx.destination)}async load(){const t=await fetch(this.url),i=await t.arrayBuffer();this.buffer=await s.ctx.decodeAudioData(i)}play(t=1){const i=s.ctx.createBufferSource();i.buffer=this.buffer,i.connect(this.gainNode),i.playbackRate.value=t,i.start()}}s.ctx=new AudioContext;const r=new s(n.p+"assets/audio/hit.ogg",.1);class a{constructor(t,i=8){this.rowCount=i,this.yOffset=10,this.pinSpacing=8,this.pinRadius=8,this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.hitPins=[],this.graphSize=0,this.hitPins=new Array(this.rowCount);for(let t=0;t<this.rowCount;++t)this.hitPins[t]={hitCount:0,lastTimeHit:-1};this.onCanvasResize(t)}onCanvasResize(t){const i=Math.min(t.clientWidth,t.clientHeight);this.pinSpacing=i/(10*this.rowCount),this.pinRadius=i/(5*this.rowCount),this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.graphSize=i/4;const n=this.rowCount*this.rowHeight+this.graphSize;this.yOffset=.5*(t.clientHeight-n)}render(t){let i=0;this.hitPins.forEach((t=>{t.hitCount>i&&(i=t.hitCount)})),this.renderDistribution(t);for(let n=0;n<this.rowCount;++n)for(let e=0;e<n+1;++e){const o={position:this.getPinPosition({row:n,idx:e}),radius:this.pinRadius,color:"#cc241d"},s=n===this.rowCount-1;if(s){o.radius*=2;const n=this.hitPins[e].hitCount/i;this.renderGraphLine(t,o.position.x,o.position.y,n),this.handleHitPinAnimation(e,o)}this.renderPin(o),s&&this.renderHitPinText(e,o)}}registerHit(t,i=!0){const n=this.hitPins[t];++n.hitCount,n.lastTimeHit=performance.now(),i&&r.play(.5+1*Math.random())}getNextPin(t){const i=t.row+1;let n;return n=0===t.idx?Math.random()>.5?0:1:t.idx===t.row?Math.random()>.5?i-1:i:t.idx+(Math.random()>.5?0:1),{row:i,idx:n}}getPinPosition(t){return{x:.5*u.canvas.clientWidth-t.row*this.rowHeight+t.idx*this.rowHeight*2,y:this.getRowY(t.row)}}getRowY(t){return this.pinRadius+t*this.rowHeight+this.yOffset}simulate(t){for(let i=0;i<t;++i){let t={row:0,idx:0};for(;t.row<this.rowCount-1;)t=this.getNextPin(t);this.registerHit(t.idx,!1)}r.play(.5+1*Math.random())}renderPin(t){u.beginPath(),u.arc(t.position.x,t.position.y,t.radius,0,2*Math.PI),u.fillStyle=t.color,u.fill()}renderHitPinText(t,i){u.fillStyle="#fbf1c7",u.textAlign="center",u.textBaseline="top",u.font=`bold ${i.radius}px monospace`,u.fillText(this.hitPins[t].hitCount.toString(),i.position.x,i.position.y-.5*i.radius,2*i.radius)}renderGraphLine(t,i,n,e){t.beginPath(),t.fillStyle="#fbf1c7",t.roundRect(i-this.pinRadius,n,2*this.pinRadius,e*this.graphSize,[0,0,this.pinRadius,this.pinRadius]),t.fill(),t.beginPath()}renderDistribution(i){const n={row:this.rowCount-1,idx:0},e={row:this.rowCount-1,idx:this.rowCount-1},o=this.getPinPosition(n).x-2*this.pinRadius,s=this.getRowY(this.rowCount-1)+2,r=this.getPinPosition(e).x+2*this.pinRadius-o,a=t.binomialDistribution(this.rowCount-1,Math.floor(this.rowCount/2),.5);i.beginPath(),i.moveTo(o,s);const h=r/100;for(let n=1;n<=100;++n){const e=o+n*h,u=(e-o)/r*(this.rowCount-1),l=s+t.binomialDistribution(this.rowCount-1,u,.5)/a*(this.graphSize+2);i.lineTo(e,l)}i.strokeStyle="#458588",i.lineWidth=2,i.stroke()}handleHitPinAnimation(i,n){const e=this.hitPins[i];if(e.lastTimeHit>-1){const i=performance.now()-e.lastTimeHit;if(i<a.hitPinAnimationDuration){const e=i/a.hitPinAnimationDuration;n.position.y+=Math.sin(e*Math.PI)*n.radius,n.radius+=Math.sin(e*Math.PI)*n.radius*.2,n.color=t.lerpColor(n.color,"#00ff00",e)}}}}a.hitPinAnimationDuration=100;const h=a,u=document.getElementById("canvas").getContext("2d",{alpha:!1,willReadFrequently:!1});let l=new h(u.canvas,19);const c=[];let d=0;function p(t){if(requestAnimationFrame(p),document.hidden)return;const i=Math.min(t-d,100);d=t,u.fillStyle="#282828",u.fillRect(0,0,u.canvas.clientWidth,u.canvas.clientHeight),l.render(u),c.forEach(((t,n,e)=>{t.update(l,i),t.queueDelete?e.splice(n,1):t.render(l,u)}))}function g(){c.push(new o({x:.5*u.canvas.clientWidth,y:-l.pinRadius})),setTimeout(g,i.ballSpawnInterval+Math.random()*i.ballSpawnInterval*.1)}function f(t){c.length=0,l=new h(u.canvas,t)}!function(){u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high";const t=()=>{u.canvas.width=window.innerWidth,u.canvas.height=window.innerHeight,l.onCanvasResize(u.canvas)};i.init(),t(),window.addEventListener("resize",(()=>t())),requestAnimationFrame(p),g()}()})();