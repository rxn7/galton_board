(()=>{"use strict";var t,i,n={d:(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};n.d({},{e:()=>r,O:()=>p}),function(t){const i=Math.PI/180;function n(t,i,n){return t+(i-t)*n}t.degreesToRadians=t=>t*i,t.directionFromAngle=function(i){const n=t.degreesToRadians(i);return{x:Math.cos(n),y:Math.sin(n)}},t.maxFromArray=function(t){if(0===t.length)return NaN;let i=t[0];for(let n of t)n>i&&(i=n);return i},t.lerp=n,t.lerpVector2=function(t,i,e){return{x:n(t.x,i.x,e),y:n(t.y,i.y,e)}}}(t||(t={})),function(t){document.getElementById("row-count-input").addEventListener("input",(t=>{p(parseInt(t.target.value))})),t.ballBounceTime=500;const i=document.getElementById("ball-bounce-time-input");i.value=t.ballBounceTime.toString(),i.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballBounceTime=n})),t.ballSpawnInterval=500;const n=document.getElementById("ball-spawn-interval-input");n.value=t.ballSpawnInterval.toString(),n.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballSpawnInterval=n}))}(i||(i={}));class e{constructor(t){this.startPosition=t,this.queueDelete=!1,this.position={x:0,y:0},this.timer=0,this.lastPin=void 0,this.nextPin={row:0,idx:0},this.position=t}update(n,o){this.timer+=o;const s=this.lastPin?n.getPinPosition(this.lastPin):this.startPosition,a=n.getPinPosition(this.nextPin),r=Math.min(this.timer/i.ballBounceTime,1);if(this.position=this.bouncePosition(n,t.lerpVector2(s,a,r),r),r>=1){if(this.timer=0,this.nextPin.row>=n.rowCount-1)return this.queueDelete=!0,void n.registerHit(this.nextPin.idx);this.calculateNextPin(n),e.bounceAudio.play()}}render(t,i){i.beginPath(),i.fillStyle=e.color,i.arc(this.position.x,this.position.y,t.pinRadius,0,2*Math.PI,!1),i.fill()}calculateNextPin(t){this.lastPin=this.nextPin,this.nextPin=t.getNextPin(this.lastPin)}bouncePosition(t,i,n){const e=Math.sin(n*Math.PI)*t.pinRadius*3;return{x:i.x,y:i.y-e}}}e.bounceAudio=new class{constructor(t,i=10){this.url=t,this.poolSize=i,this.pool=[];const n=new Audio(t);for(let t=0;t<this.poolSize;++t)this.pool.push(this.createAudio(n))}createAudio(t){const i=t.cloneNode();return i.addEventListener("ended",(()=>{this.pool.push(i)})),i}play(){0!==this.pool.length&&this.pool.pop().play()}}("audio/bounce.ogg",15),e.color="#689d6a";const o=e;class s{constructor(t,i=8){this.rowCount=i,this.yOffset=10,this.pinSpacing=8,this.pinRadius=8,this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.columnsHitCount=[],this.graphSize=100;for(let t=0;t<this.rowCount;++t)this.columnsHitCount.push(0);this.onCanvasResize(t)}onCanvasResize(t){const i=Math.min(t.clientWidth,t.clientHeight);this.pinSpacing=i/(12*this.rowCount),this.pinRadius=i/(8*this.rowCount),this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.graphSize=i/10;const n=this.rowCount*this.rowHeight+this.graphSize;this.yOffset=.5*(t.clientHeight-n)}render(i){const n=t.maxFromArray(this.columnsHitCount);for(let t=0;t<this.rowCount;++t)for(let e=0;e<t+1;++e){const o=this.getPinPosition({row:t,idx:e}),s=t===this.rowCount-1;let a=this.pinRadius;if(s){a*=2;const t=this.columnsHitCount[e]/n;this.renderGraphLine(i,o.x,o.y,t)}else a*=.5;i.beginPath(),i.arc(o.x,o.y,a,0,2*Math.PI),i.fillStyle="#cc241d",i.fill(),s&&(i.fillStyle="#fbf1c7",i.textAlign="center",i.textBaseline="top",i.font=`bold ${a}px monospace`,i.fillText(this.columnsHitCount[e].toString(),o.x,o.y-.5*a,2*a))}}registerHit(t){++this.columnsHitCount[t]}renderGraphLine(t,i,n,e){t.beginPath(),t.fillStyle=o.color,t.roundRect(i-this.pinRadius,n,2*this.pinRadius,e*this.graphSize,[0,0,this.pinRadius,this.pinRadius]),t.fill(),t.beginPath()}getNextPin(t){const i=t.row+1;let n;return n=0===t.idx?Math.random()>.5?0:1:t.idx===t.row?Math.random()>.5?i-1:i:t.idx+(Math.random()>.5?0:1),{row:i,idx:n}}getPinPosition(t){return{x:.5*r.canvas.clientWidth-t.row*this.rowHeight+t.idx*this.rowHeight*2,y:this.pinRadius+t.row*this.rowHeight+this.yOffset}}}const a=1/60,r=document.getElementById("canvas").getContext("2d",{alpha:!1,willReadFrequently:!1});let l=new s(r.canvas,19);const h=[];let c=0;function u(t){const i=Math.max(t-c,a);c=t,r.fillStyle="#282828",r.fillRect(0,0,r.canvas.clientWidth,r.canvas.clientHeight),l.render(r),h.forEach(((t,n,e)=>{t.update(l,i),t.queueDelete?e.splice(n,1):t.render(l,r)})),requestAnimationFrame(u)}function d(){h.push(new o({x:.5*r.canvas.clientWidth,y:-l.pinRadius})),setTimeout(d,i.ballSpawnInterval+Math.random()*i.ballSpawnInterval*.1)}function p(t){h.length=0,l=new s(r.canvas,t)}!function(){r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high";const t=()=>{r.canvas.width=window.innerWidth,r.canvas.height=window.innerHeight,l.onCanvasResize(r.canvas)};t(),window.addEventListener("resize",(()=>t())),requestAnimationFrame(u),d()}()})();