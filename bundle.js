(()=>{"use strict";var t,i,n={d:(t,i)=>{for(var e in i)n.o(i,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})}};n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var i=n.g.document;if(!t&&i&&(i.currentScript&&"SCRIPT"===i.currentScript.tagName.toUpperCase()&&(t=i.currentScript.src),!t)){var e=i.getElementsByTagName("script");if(e.length)for(var s=e.length-1;s>-1&&(!t||!/^http(s?):/.test(t));)t=e[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.d({},{no:()=>l,ej:()=>c,OQ:()=>f}),function(t){const i=Math.PI/180;function n(t,i,n){return t+(i-t)*n}t.degreesToRadians=t=>t*i,t.directionFromAngle=function(i){const n=t.degreesToRadians(i);return{x:Math.cos(n),y:Math.sin(n)}},t.maxFromArray=function(t){if(0===t.length)return NaN;let i=t[0];for(let n of t)n>i&&(i=n);return i},t.lerp=n,t.lerpVector2=function(t,i,e){return{x:n(t.x,i.x,e),y:n(t.y,i.y,e)}},t.lerpColor=function(t,i,e){const s=parseInt(t.substring(1,3),16),o=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),a=parseInt(i.substring(1,3),16),h=parseInt(i.substring(3,5),16),c=parseInt(i.substring(5,7),16);return`rgb(${Math.round(n(s,a,e))},${Math.round(n(o,h,e))},${Math.round(n(r,c,e))})`}}(t||(t={})),function(t){const i=document.getElementById("row-count-input");i.addEventListener("input",(t=>{f(parseInt(t.target.value))})),t.ballBounceTime=200;const n=document.getElementById("ball-bounce-time-input");n.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballBounceTime=n})),t.ballSpawnInterval=150;const e=document.getElementById("ball-spawn-interval-input");e.addEventListener("input",(i=>{const n=parseInt(i.target.value);t.ballSpawnInterval=n})),t.init=function(){e.value=t.ballSpawnInterval.toString(),n.value=t.ballBounceTime.toString(),i.value=l.rowCount.toString()}}(i||(i={}));class e{constructor(t){this.startPosition=t,this.queueDelete=!1,this.position={x:0,y:0},this.timer=0,this.lastPin=void 0,this.nextPin={row:0,idx:0},this.position=t}update(n,e){this.timer+=e;const s=this.lastPin?n.getPinPosition(this.lastPin):this.startPosition,o=n.getPinPosition(this.nextPin),r=Math.min(this.timer/i.ballBounceTime,1);if(this.position=this.bouncePosition(n,t.lerpVector2(s,o,r),r),r>=1){if(this.timer=0,this.nextPin.row>=n.rowCount-1)return this.queueDelete=!0,void n.registerHit(this.nextPin.idx);this.calculateNextPin(n)}}render(t,i){i.beginPath(),i.fillStyle=e.color,i.arc(this.position.x,this.position.y,t.pinRadius,0,2*Math.PI,!1),i.fill()}calculateNextPin(t){this.lastPin=this.nextPin,this.nextPin=t.getNextPin(this.lastPin)}bouncePosition(t,i,n){const e=Math.sin(n*Math.PI)*t.pinRadius*3;return{x:i.x,y:i.y-e}}}e.color="#689d6a";const s=e;class o{constructor(t,i=1){this.url=t,this.gainNode=o.ctx.createGain(),this.load(),this.gainNode.gain.value=i,this.gainNode.connect(o.ctx.destination)}async load(){const t=await fetch(this.url),i=await t.arrayBuffer();this.buffer=await o.ctx.decodeAudioData(i)}play(t=1){const i=o.ctx.createBufferSource();i.buffer=this.buffer,i.connect(this.gainNode),i.playbackRate.value=t,i.start()}}o.ctx=new AudioContext;const r=new o(n.p+"assets/audio/hit.ogg",.1);class a{constructor(t,i=8){this.rowCount=i,this.yOffset=10,this.pinSpacing=8,this.pinRadius=8,this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.hitPins=[],this.graphSize=0,this.hitPins=new Array(this.rowCount);for(let t=0;t<this.rowCount;++t)this.hitPins[t]={hitCount:0,lastTimeHit:-1};this.onCanvasResize(t)}onCanvasResize(t){const i=Math.min(t.clientWidth,t.clientHeight);this.pinSpacing=i/(10*this.rowCount),this.pinRadius=i/(5*this.rowCount),this.rowHeight=2*this.pinSpacing+2*this.pinRadius,this.graphSize=i/4;const n=this.rowCount*this.rowHeight+this.graphSize;this.yOffset=.5*(t.clientHeight-n)}render(t){let i=0;this.hitPins.forEach((t=>{t.hitCount>i&&(i=t.hitCount)}));for(let n=0;n<this.rowCount;++n)for(let e=0;e<n+1;++e){const s={position:this.getPinPosition({row:n,idx:e}),radius:this.pinRadius,color:"#cc241d"},o=n===this.rowCount-1;if(o){s.radius*=2;const n=this.hitPins[e].hitCount/i;this.renderGraphLine(t,s.position.x,s.position.y,n),this.handleHitPinAnimation(e,s)}this.renderPin(s),o&&this.renderHitPinText(e,s)}}registerHit(t){const i=this.hitPins[t];++i.hitCount,i.lastTimeHit=performance.now(),r.play(.5+1*Math.random())}getNextPin(t){const i=t.row+1;let n;return n=0===t.idx?Math.random()>.5?0:1:t.idx===t.row?Math.random()>.5?i-1:i:t.idx+(Math.random()>.5?0:1),{row:i,idx:n}}getPinPosition(t){return{x:.5*c.canvas.clientWidth-t.row*this.rowHeight+t.idx*this.rowHeight*2,y:this.pinRadius+t.row*this.rowHeight+this.yOffset}}renderPin(t){c.beginPath(),c.arc(t.position.x,t.position.y,t.radius,0,2*Math.PI),c.fillStyle=t.color,c.fill()}renderHitPinText(t,i){c.fillStyle="#fbf1c7",c.textAlign="center",c.textBaseline="top",c.font=`bold ${i.radius}px monospace`,c.fillText(this.hitPins[t].hitCount.toString(),i.position.x,i.position.y-.5*i.radius,2*i.radius)}renderGraphLine(t,i,n,e){t.beginPath(),t.fillStyle="#fbf1c7",t.roundRect(i-this.pinRadius,n,2*this.pinRadius,e*this.graphSize,[0,0,this.pinRadius,this.pinRadius]),t.fill(),t.beginPath()}handleHitPinAnimation(i,n){const e=this.hitPins[i];if(e.lastTimeHit>-1){const i=performance.now()-e.lastTimeHit;if(i<a.hitPinAnimationDuration){const e=i/a.hitPinAnimationDuration;n.position.y+=Math.sin(e*Math.PI)*n.radius,n.radius+=Math.sin(e*Math.PI)*n.radius*.2,n.color=t.lerpColor(n.color,"#00ff00",e)}}}}a.hitPinAnimationDuration=100;const h=a,c=document.getElementById("canvas").getContext("2d",{alpha:!1,willReadFrequently:!1});let l=new h(c.canvas,19);const u=[];let d=0;function p(t){if(requestAnimationFrame(p),document.hidden)return;const i=Math.min(t-d,100);d=t,c.fillStyle="#282828",c.fillRect(0,0,c.canvas.clientWidth,c.canvas.clientHeight),l.render(c),u.forEach(((t,n,e)=>{t.update(l,i),t.queueDelete?e.splice(n,1):t.render(l,c)}))}function g(){u.push(new s({x:.5*c.canvas.clientWidth,y:-l.pinRadius})),setTimeout(g,i.ballSpawnInterval+Math.random()*i.ballSpawnInterval*.1)}function f(t){u.length=0,l=new h(c.canvas,t)}!function(){c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high";const t=()=>{c.canvas.width=window.innerWidth,c.canvas.height=window.innerHeight,l.onCanvasResize(c.canvas)};i.init(),t(),window.addEventListener("resize",(()=>t())),requestAnimationFrame(p),g()}()})();